

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tutorial: Getting Started &mdash; p-RSoXR 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tutorial: Multi-Energy refinement" href="PyPXR_MultiEnRefinement.html" />
    <link rel="prev" title="Modeling/Fitting with PyPXR:" href="../DataModeling_home.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> p-RSoXR
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DataCollection_home.html">Tutorial on Collecting Data:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DataReduction_home.html">Reducing data to 1D profiles:</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../DataModeling_home.html">Modeling/Fitting with PyPXR:</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial: Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Creating-a-model">Creating a model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-polarized-X-ray-reflectivity">Calculating polarized X-ray reflectivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fitting-data">Fitting data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="PyPXR_MultiEnRefinement.html">Tutorial: Multi-Energy refinement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../references_home.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legal.html">NIST Legal</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">p-RSoXR</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../DataModeling_home.html">Modeling/Fitting with PyPXR:</a> &raquo;</li>
        
      <li>Tutorial: Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/source/DataModeling/PyPXR_Tutorials.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Tutorial:-Getting-Started">
<h1>Tutorial: Getting Started<a class="headerlink" href="#Tutorial:-Getting-Started" title="Permalink to this headline">¶</a></h1>
<p>PyPXR is designed to tackle reflectivity datasets measured over many eneriges and polarizations. This process is analogous to changing contrast in Neutron reflectivity that provides more information about a given system. Co-refinement of multiple datasets is essential to achieve a unique solution with PyPXR.</p>
<p>This tutorial will guide you through the basic steps to build and subsequently refine a slab model to fit polarized reflectivity of a glassy thin film. It is recommended that you are familiar with modeling reflectivity from hard X-rays or neutrons prior to polarized X-ray reflectivity. An excellent example can be found in the ‘Getting Started’ section within the <em>refnx</em> documentation.</p>
<div class="section" id="Creating-a-model">
<h2>Creating a model<a class="headerlink" href="#Creating-a-model" title="Permalink to this headline">¶</a></h2>
<p>Load the necessary packages for PyPXR modeling</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;../../../src/PyPXR&quot;</span><span class="p">)</span> <span class="c1"># Temporary solution until hosted on pip</span>

<span class="kn">from</span> <span class="nn">reflectivity</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">structure</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<p>PyPXR builds a <code class="docutils literal notranslate"><span class="pre">PXR_Structure</span></code> by combining <code class="docutils literal notranslate"><span class="pre">PXR_Slab</span></code> objects into a vertical stack and calculates the expected specular reflectivity given an incident energy and polarization. Individual slabs are composed of a material bounded by two interfaces. Each material is defined through its complex tensor index of refraction, <span class="math notranslate nohighlight">\(n(E) = 1-\delta(E) + i \beta(E)\)</span>. <span class="math notranslate nohighlight">\(\delta\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are proportional to the real and imaginary scattering length densities and can either be a scalar or
a tensor. PyPXR uses conventions in soft X-ray science so all optical parameters are defined in terms of <span class="math notranslate nohighlight">\(n(E)\)</span>.</p>
<p>The begin every model, we first need to define the materials within our sample. The easiest way to do this is by using the <code class="docutils literal notranslate"><span class="pre">PXR_SLD</span></code> object (for resonant isotropic/anisotropic materials) and the <code class="docutils literal notranslate"><span class="pre">PXR_MaterialSLD</span></code> object (for non-resonant materials). <em>Note:</em> many objects in PyPXR are similarly named to the equivalent refnx object to help aleviate any learning curve.</p>
<p><code class="docutils literal notranslate"><span class="pre">PXR_SLD</span></code> is ideal when materials are resonant with the chosen photon energy and dielectric function cannot be referenced with <em>PeriodicTable</em>. Objects will be assigned a complex tensor index of refraction defined with the extraordinary axis perpdindicular to the substrate and ordinary axis parallel with the substrate.</p>
<p><code class="docutils literal notranslate"><span class="pre">PXR_MaterialSLD</span></code> is for materials that are not resonant with the chosen photon energy. This option is commonly used to define substrates and superstrates. It uses <em>PeriodicTable</em> to determine <span class="math notranslate nohighlight">\(n(E)\)</span>. <em>This function requires an explicit photon energy.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">en</span> <span class="o">=</span> <span class="mf">284.7</span> <span class="c1">#[eV]</span>

<span class="n">si</span> <span class="o">=</span> <span class="n">PXR_MaterialSLD</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">2.33</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Si&#39;</span><span class="p">)</span> <span class="c1">#Substrate</span>
<span class="n">sio2</span> <span class="o">=</span> <span class="n">PXR_MaterialSLD</span><span class="p">(</span><span class="s1">&#39;SiO2&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">2.28</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SiO2&#39;</span><span class="p">)</span> <span class="c1">#Substrate</span>
<span class="n">vacuum</span> <span class="o">=</span> <span class="n">PXR_MaterialSLD</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vacuum&#39;</span><span class="p">)</span> <span class="c1">#Superstrate</span>


<span class="n">n_xx</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00033</span><span class="p">,</span> <span class="mf">0.000113</span><span class="p">)</span> <span class="c1"># [unitless] #Ordinary Axis</span>
<span class="n">n_zz</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0004</span><span class="p">,</span> <span class="mf">0.00028</span><span class="p">)</span> <span class="c1"># [unitless] #Extraordinary Axis</span>
<span class="n">posa</span> <span class="o">=</span> <span class="n">PXR_SLD</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_xx</span><span class="p">,</span> <span class="n">n_zz</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;posaconazole&#39;</span><span class="p">)</span> <span class="c1">#Molecule</span>
</pre></div>
</div>
</div>
<p>In this example, our thin film is composed of a vapor deposited glassy thin film on a silicon substrate. We are going to assume our film is uniaxial in the laboratory frame and only defined by <code class="docutils literal notranslate"><span class="pre">n_xx</span></code> and <code class="docutils literal notranslate"><span class="pre">n_zz</span></code>.</p>
<p>We can now build multiple <code class="docutils literal notranslate"><span class="pre">PXR_Slab</span></code> objects using our newly defined materials. Physical dimensions include thickness and surface roughness (both in Angstroms). Currently, the only interface that is supported is a Nevot-Croce roughness and the input corresponds to the width of an error function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Substrate objects</span>
<span class="c1">#(thickness, roughness)</span>
<span class="n">si_slab</span> <span class="o">=</span> <span class="n">si</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="c1">#thickness of bounding substrate does not matter</span>
<span class="n">sio2_slab</span> <span class="o">=</span> <span class="n">sio2</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#Film bulk</span>
<span class="n">posa_slab</span> <span class="o">=</span> <span class="n">posa</span><span class="p">(</span><span class="mi">711</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Our composite <code class="docutils literal notranslate"><span class="pre">PXR_Structure</span></code> can now be generated by combining each<code class="docutils literal notranslate"><span class="pre">PXR_Slab</span></code> with the following convention.</p>
<p><em>structure = Superstrate | top layer | mid layers | … | bottom layer | Substrate</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">structure</span> <span class="o">=</span> <span class="n">vacuum</span> <span class="o">|</span> <span class="n">posa_slab</span> <span class="o">|</span> <span class="n">sio2_slab</span> <span class="o">|</span> <span class="n">si_slab</span>
</pre></div>
</div>
</div>
<p>The current model can be viewed with the <code class="docutils literal notranslate"><span class="pre">structure.plot()</span></code> function. The resulting plot will give a summary of the complex tensor components as a function of depth from the film surface. Setting <code class="docutils literal notranslate"><span class="pre">difference=True</span></code> provides a complimentary plot of the film birefringence: (<span class="math notranslate nohighlight">\(\delta_{xx} - \delta_{zz}\)</span>) and the dichroism: (<span class="math notranslate nohighlight">\(\beta_{xx} - \beta_{zz})\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">structure</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 432x288 with 1 Axes&gt;,
 &lt;AxesSubplot:xlabel=&#39;zed / $\\AA$&#39;, ylabel=&#39;Index of refraction&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_14_1.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_14_1.png" />
</div>
</div>
<p>Note that in addition to the individual components, the <em>delta</em> and <em>beta</em> profiles correspond to the normalized trace of the dielectric tensor. This is equivalent to the components of an <em>isotropic</em> material</p>
<div class="math notranslate nohighlight">
\[\delta = \frac{2\delta_{xx} + \delta_{zz}}{3}\]</div>
<div class="math notranslate nohighlight">
\[\beta = \frac{2\beta_{xx} + \beta_{zz}}{3}\]</div>
</div>
<div class="section" id="Calculating-polarized-X-ray-reflectivity">
<h2>Calculating polarized X-ray reflectivity<a class="headerlink" href="#Calculating-polarized-X-ray-reflectivity" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a preliminary model, we can define an X-ray probe through the <code class="docutils literal notranslate"><span class="pre">PXR_ReflectModel</span></code> object.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_spol</span> <span class="o">=</span> <span class="n">PXR_ReflectModel</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">en</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;spol&#39;</span><span class="p">))</span>
<span class="n">model_ppol</span> <span class="o">=</span> <span class="n">PXR_ReflectModel</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">en</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ppol&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PXR_ReflectModel</span></code> requires two additional inputs to specify the incident X-rays: <code class="docutils literal notranslate"><span class="pre">pol</span></code> is used to define the linear polarization state, and <code class="docutils literal notranslate"><span class="pre">en</span></code> is used to specify the photon energy. Any <code class="docutils literal notranslate"><span class="pre">PXR_Slab</span></code> or <code class="docutils literal notranslate"><span class="pre">PXR_MaterialSLD</span></code> that requires an input photon energy will be updated at this time. It is not necessary to create a substrate object for each energy you wish to fit.</p>
<p>We can plot each profile given the input model and a set of q-values to take a measurement.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">qvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qvals</span><span class="p">,</span> <span class="n">model_spol</span><span class="p">(</span><span class="n">qvals</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;spol&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qvals</span><span class="p">,</span> <span class="n">model_ppol</span><span class="p">(</span><span class="n">qvals</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ppol&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectivity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;q [A-1]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1b9860aa970&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_20_1.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_20_1.png" />
</div>
</div>
<p>Success! The plot above gives the expected specular reflectivity of our input structure based on the incident polarization. Note the difference in reflectance at low angles, this is a result of the uniaxial response</p>
</div>
<div class="section" id="Fitting-data">
<h2>Fitting data<a class="headerlink" href="#Fitting-data" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a model, we want to use it to fit some real data. PyPXR utilizes the refnx package for all fitting and requires the following imports.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">refnx.dataset</span> <span class="kn">import</span> <span class="n">ReflectDataset</span> <span class="c1"># Object used to define data</span>
<span class="kn">from</span> <span class="nn">refnx.analysis</span> <span class="kn">import</span> <span class="n">Transform</span><span class="p">,</span> <span class="n">CurveFitter</span><span class="p">,</span> <span class="n">Objective</span> <span class="c1"># For fitting</span>
</pre></div>
</div>
</div>
<p>An example set of data can be downloaded from the GitHub repository.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mypath</span> <span class="o">=</span> <span class="s2">&quot;../../../src/PyPXR/example_data/&quot;</span>
<span class="n">mypath_s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span> <span class="s1">&#39;Feb19_Exp101_p100.txt&#39;</span><span class="p">)</span>  <span class="c1"># s-pol data</span>
<span class="n">mypath_p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span> <span class="s1">&#39;Feb19_Exp101_p190.txt&#39;</span><span class="p">)</span>  <span class="c1"># p-pol data</span>

<span class="n">mydata_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">mypath_s</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">mydata_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">mypath_p</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To help speed up the fitting process, we will concatenate our data to fit both polarizations simultaneously.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">mydata_s</span><span class="p">,</span> <span class="n">mydata_p</span><span class="p">])</span> <span class="c1"># Concatenate data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ReflectDataset</span><span class="p">(</span><span class="n">mydata</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="c1"># Transpose to set the axis correctly</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">PXR_ReflectModel</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">en</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="s1">&#39;sp&#39;</span><span class="p">)</span> <span class="c1"># Model that outputs a concatenated result</span>
</pre></div>
</div>
</div>
<p>Data is combined with a model in the form of an <code class="docutils literal notranslate"><span class="pre">Objective</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">Transform</span><span class="p">(</span><span class="s1">&#39;logY&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Objectives can be quickly plotted to get a sense of how well your initial model agrees with the data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objective</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;q [A-1]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;q [A-1]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_32_1.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_32_1.png" />
</div>
</div>
<p>Oh no! Our initial model looks like it could use some improvements.</p>
<p>As it turns out, our data does not exhibit any indication of Brewsters angle at <span class="math notranslate nohighlight">\(\approx0.2A^-1\)</span>. This is an indication that our structure may be more complicated than a single layer model. Lets add an additional layer to the surface and remodel the data, we can always remove it later.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Make the new index of refraction</span>
<span class="n">n2_xx</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0004</span><span class="p">,</span> <span class="mf">0.000627</span><span class="p">)</span> <span class="c1"># [unitless] #Ordinary Axis</span>
<span class="n">n2_zz</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.000003</span><span class="p">)</span> <span class="c1"># [unitless] #Extraordinary Axis</span>
<span class="n">posa_surface</span> <span class="o">=</span> <span class="n">PXR_SLD</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n2_xx</span><span class="p">,</span> <span class="n">n2_zz</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;material2&#39;</span><span class="p">)</span> <span class="c1">#Molecule</span>
<span class="n">posa_surface_slab</span> <span class="o">=</span> <span class="n">posa_surface</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Reinitialize the model functions</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">vacuum</span> <span class="o">|</span> <span class="n">posa_surface_slab</span> <span class="o">|</span> <span class="n">posa_slab</span> <span class="o">|</span> <span class="n">sio2_slab</span> <span class="o">|</span> <span class="n">si_slab</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">PXR_ReflectModel</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">en</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="s1">&#39;sp&#39;</span><span class="p">)</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">Transform</span><span class="p">(</span><span class="s1">&#39;logY&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objective</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;q [A-1]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;q [A-1]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_35_1.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_35_1.png" />
</div>
</div>
<p>Much better! While our model clearly needs some refinement, its initial structure is not too far off from the data.</p>
<p>To begin fitting, we need to setup the parameters that we want to vary. This uses the <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> functionality within <em>refnx</em></p>
<p>Each object that we have created has several optional parameters</p>
<p><code class="docutils literal notranslate"><span class="pre">PXR_Slab</span></code> - Thickness : (‘thick’) - Roughness : (‘rough’)</p>
<p><code class="docutils literal notranslate"><span class="pre">PXR_MaterialSLD</span></code> - Density : (‘density’)</p>
<p><code class="docutils literal notranslate"><span class="pre">PXR_Slab</span></code> - ordinary component of delta : (‘xx and yy’) - extraordinary component of delta : (‘zz’) - ordinary component of beta : (‘ixx and iyy’) - extraordinary component of beta : (‘izz’) - <em>Optional parameters:</em> - normalized trace of delta : (‘diso’) - normalized trace of beta : (‘biso’) - Birefringence : (‘birefringence’) - Dichroism : (‘dichroism’)</p>
<p>Optional parameters allow for alternative parameterizations through constraints. Only ‘xx’, ‘yy’, ‘zz’, ‘ixx’, ‘iyy’, and ‘izz’ are physically used in the calculation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Substrates</span>
<span class="n">si_slab</span><span class="o">.</span><span class="n">thick</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">si_slab</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">sio2_slab</span><span class="o">.</span><span class="n">thick</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">sio2_slab</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sio2_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># The default tensor symmetry is for uniaxial materials.</span>
<span class="c1"># This automatically sets constraints for xx = yy and ixx = iyy</span>
<span class="n">posa_slab</span><span class="o">.</span><span class="n">thick</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">900</span><span class="p">))</span>
<span class="n">posa_slab</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">posa_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">xx</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">posa_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">zz</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">posa_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">ixx</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="n">posa_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">izz</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>

<span class="n">posa_surface_slab</span><span class="o">.</span><span class="n">thick</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
<span class="n">posa_surface_slab</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">posa_surface_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">xx</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">posa_surface_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">zz</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">posa_surface_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">ixx</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="n">posa_surface_slab</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">izz</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>

</pre></div>
</div>
</div>
<p>A composite list of open parameters can be examined by looking at the <code class="docutils literal notranslate"><span class="pre">Objective.varying_parameters()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">varying_parameters</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
________________________________________________________________________________
Parameters:      None
&lt;Parameter:&#39;material2_thick&#39;, value=15          , bounds=[5.0, 30.0]&gt;
&lt;Parameter:&#39;material2_xx&#39; , value=-0.0004          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;material2_ixx&#39;, value=0.000627          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;material2_zz&#39; , value=-0.0005          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;material2_izz&#39;, value=3e-06          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;material2_rough&#39;, value=1          , bounds=[0.5, 20.0]&gt;
&lt;Parameter:&#39;posaconazole_thick&#39;, value=711          , bounds=[400.0, 900.0]&gt;
&lt;Parameter:&#39;posaconazole_xx&#39;, value=-0.00033          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;posaconazole_ixx&#39;, value=0.000113          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;posaconazole_zz&#39;, value=-0.0004          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;posaconazole_izz&#39;, value=0.00028          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;posaconazole_rough&#39;, value=2          , bounds=[0.2, 20.0]&gt;
&lt;Parameter: &#39;SiO2_thick&#39;  , value=12          , bounds=[5.0, 20.0]&gt;
&lt;Parameter: &#39;SiO2_rough&#39;  , value=1          , bounds=[2.0, 10.0]&gt;
</pre></div></div>
</div>
<p>Our final step is to create a <code class="docutils literal notranslate"><span class="pre">CurveFitter</span></code> by using the <code class="docutils literal notranslate"><span class="pre">Objective</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fitter</span> <span class="o">=</span> <span class="n">CurveFitter</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">nwalkers</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="c1"># Optionalal change to the initialization. Begin chains near initial conditions</span>
<span class="n">fitter</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;jitter&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Running a fit will envoke an <code class="docutils literal notranslate"><span class="pre">emcee</span></code> sampler object. Details on the exact algorithm can be found with the <em>emcee</em> documentation. For now, we will simply use the default <em>StretchMove</em> to run our fit.</p>
<p>In this example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1) We begin by running 2000 samples in order to find the local minima.
2) Once we have reached the minima, we will reset our chain to discard all samples that were taken outside the minima.
3) We finish by running 1000 samples within the final minima.
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">chain</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">246681</span><span class="p">)</span> <span class="c1"># seed random number generator for repeatability</span>
<span class="c1">#fitter.reset()</span>
<span class="c1">#chain = fitter.sample(1000, random_state=991166)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████████████████████████████| 10/10 [00:06&lt;00:00,  1.49it/s]
</pre></div></div>
</div>
<p>We can now check on our results by replotting the updated <code class="docutils literal notranslate"><span class="pre">Objective</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objective</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;q [A-1]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;q [A-1]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_46_1.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_46_1.png" />
</div>
</div>
<p>Looks great! What about the orientation depth profile?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 432x288 with 1 Axes&gt;, &lt;AxesSubplot:xlabel=&#39;zed / $\\AA$&#39;, ylabel=&#39;Index of refraction&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_48_1.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_48_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/source_DataModeling_PyPXR_Tutorials_48_2.png" src="../../_images/source_DataModeling_PyPXR_Tutorials_48_2.png" />
</div>
</div>
<p>So we found that our best fit model has a highly oriented surface layer and less oriented bulk.</p>
<p>We can now check on the final parameters</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="o">.</span><span class="n">varying_parameters</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
________________________________________________________________________________
Parameters:      None
&lt;Parameter:&#39;material2_thick&#39;, value=15          , bounds=[5.0, 30.0]&gt;
&lt;Parameter:&#39;material2_xx&#39; , value=-0.0004          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;material2_ixx&#39;, value=0.000627          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;material2_zz&#39; , value=-0.0005          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;material2_izz&#39;, value=3e-06          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;material2_rough&#39;, value=1          , bounds=[0.5, 20.0]&gt;
&lt;Parameter:&#39;posaconazole_thick&#39;, value=711          , bounds=[400.0, 900.0]&gt;
&lt;Parameter:&#39;posaconazole_xx&#39;, value=-0.00033          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;posaconazole_ixx&#39;, value=0.000113          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;posaconazole_zz&#39;, value=-0.0004          , bounds=[-0.01, -1e-05]&gt;
&lt;Parameter:&#39;posaconazole_izz&#39;, value=0.00028          , bounds=[0.0, 0.01]&gt;
&lt;Parameter:&#39;posaconazole_rough&#39;, value=2          , bounds=[0.2, 20.0]&gt;
&lt;Parameter: &#39;SiO2_thick&#39;  , value=12          , bounds=[5.0, 20.0]&gt;
&lt;Parameter: &#39;SiO2_rough&#39;  , value=1          , bounds=[2.0, 10.0]&gt;
</pre></div></div>
</div>
<p>In order to achieve a unique structure with resonant reflectivity it is often convenient to measure multiple energies and refine the models simultaneously. Lets do this now,</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="PyPXR_MultiEnRefinement.html" class="btn btn-neutral float-right" title="Tutorial: Multi-Energy refinement" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../DataModeling_home.html" class="btn btn-neutral float-left" title="Modeling/Fitting with PyPXR:" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright : Official Contribution of the US Government.  Not subject to copyright in the United States..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>